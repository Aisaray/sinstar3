<html>

<head>
<meta http-equiv="Content-Language" content="zh-cn">
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<meta name="GENERATOR" content="Microsoft FrontPage 6.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<title>编码编译</title>
</head>

<body background="../images/lvbkgnd.jpg">

<h1 align="center">编码编译</h1>
<blockquote>
	<p align="left" style="line-height: 150%">&nbsp;&nbsp;&nbsp; 输入之星作为一个<b><font color="#0000FF">形码平台</font></b>，提供对各种形码的支持，但不直接支持<font color="#0000FF">文本码表</font>的挂接，需要将码表通过编码编辑器转换为输入之星支持的<font color="#0000FF">码表格式</font>。输入之星支持为每一个码表指定一个图标文件和一个字根图，该图标文件会显示到输入法的状态栏上，同时可以为图标指定一个透明色。</p>
	<p align="left" style="line-height: 150%">&nbsp;&nbsp;&nbsp; 在<font color="#0000FF">系统菜单</font>--&gt;<font color="#0000FF">数据管理</font><span style="font-weight: 400"><font size="3">中选择<font color="#0000FF">编码编译</font>选项，打开下图。</font></span></p>
</blockquote>
<p align="center"><img border="0" src="../images/compeditor.gif" width="648" height="401"></p>
<h2 style="line-height: 150%">操作方法：</h2>
<blockquote>
	<p style="line-height: 150%">1、选择码表：码表必须是与“输入法生成器”导出的码表格式一致的<font color="#0000FF">ANSI编码的文本文件</font>。对编码的要求参见<a href="../附录/编码码表.htm">编码码表</a>。</p>
	<p style="line-height: 150%">2、指定保存路径。</p>
	<p style="line-height: 150%">3、如果有字根表，选择一个字根图，可以是jpg,gif,bmp这几种常用图片格式。</p>
	<p style="line-height: 150%">4、如果有图标，选择图标：图标是一个16*16的位图文件(bmp)。</p>
	<p style="line-height: 150%">5、在图标上选择一个需要透明显示的颜色。</p>
	<p style="line-height: 150%">6、如果编码方案中标点参与编码且某些字的第一码是标点，那么请清除“<font color="#FF0000">标点顶字上屏</font>”。否则这些字词将不能正确输出。</p>
	<p style="line-height: 150%">7、如果是音形码或者形音码，并且是使用拼音的首字母参与编码，选择“<font color="#FF0000">音形码优化</font>”，启用该选项后可以借助启程的多音字识别功能减少甚至消除自动词组编码中由于多音字而产生的无效编码。</p>
	<p style="line-height: 150%">8、确认是否需要“<font color="#FF0000">禁止编码导出</font>”功能，该功能可以一定程度上保护您的编码方案不被您的用户查看。启程软件不保证该功能不会被破解！</p>
	<p style="line-height: 150%">9、授权文件：如果您的编码需要收费才能使用，启程使用第三方插件的形式来支持，您需要按照启程定义的插件格式制作一个相对应的插件，点击“授权文件”功能，在显示的窗口中选择您的插件文件。参见“<a href="#收费编码解决方案">收费编码解决方案</a>”</p>
	<p style="line-height: 150%">10、点击“创建”按钮：创建成功后，服务器会提示是否安装，选择安装后，将的编码将立即安装到输入之星的系统目录。如果要使该编码立即生效，还需要在<a href="compmgr.htm">编码管理</a>页面中指定。</p>
</blockquote>
<h2 style="line-height: 150%">码表的发布：</h2>
<blockquote>
	<p style="line-height: 150%">&nbsp;&nbsp;&nbsp; 如果您自己制作的码表文件需要发布，您只需要将最后生成的*.cit这个文件交给最终用户即可。如果您得到一个码表文件(.cit)，您只需要在<a href="compmgr.htm">编码管理</a>页面中使用安装编码功能来安装新编码。</p>
</blockquote>
<h2 style="line-height: 150%"><a name="收费编码解决方案">收费编码解决方案</a>：</h2>
<blockquote>
	<p style="line-height: 150%">&nbsp;&nbsp;&nbsp;
启程使用第三方插件的形式来支持收费编码，当您的编码需要收费且选择在启程中发布时，您需要根据启程定义的插件格式制作一个相对应的插件，该插件是一个导出一个C语言模式接口的动态库(DLL)，只需要导出唯一的接口：<font COLOR="#880000">VerifyUser，</font>在启程中每次打开您的编码时，启程会调用一次该接口，您可以在这个接口中控制用户可不可以继续使用您的编码。
在制作编码时，选择授权文件后，授权文件信息会被加密保存到编码文件中，启程在调用插件时先验证插件的合法性，以防止插件被非法修改。</p>
</blockquote>
<p style="line-height: 150%">
<font color="#FF0000">注：有盾必有矛，任何加密方法都不可能绝对的安全！因此启程不保证您的编码及插件不被破解！一旦被破解，启程不负任何责任！</font></p>
<p style="line-height: 150%">
<font color="#FF0000">另：启程是一个免费输入法平台，但是<b>不包含收费码表</b>。收费码表需要在启程上发布需要获得启程的授权才能发布！</font></p>
<p>
下面的代码是示例插件代码。完整代码参见启程官方网站：<a href="http://www.setoutsoft.cn">http://www.setoutsoft.cn</a></p>
<font COLOR="#a000a0">
<p>__declspec</font>(dllexport)　int <font COLOR="#880000">VerifyUser</font>(const 
char * <font COLOR="#808080">pszPath</font>)</p>
<p>{</p>
<blockquote>
	<p>char <font COLOR="#808080">szLience</font>[<font COLOR="#a000a0">MAX_PATH</font>];</p>
	<p>char <font COLOR="#808080">szKey</font>[32]=<font COLOR="#000077">&quot;demo&quot;</font>;</p>
	<p><font COLOR="#009900">//从授权文件中用户的授权状态</p>
	</font>
	<p><font COLOR="#880000">sprintf</font>(<font COLOR="#808080">szLience</font>,<font COLOR="#000077">&quot;%smycode.txt&quot;</font>,<font COLOR="#808080">pszPath</font>);</p>
	<p>FILE *<font COLOR="#808080">f</font>=<font COLOR="#880000">fopen</font>(<font COLOR="#808080">szLience</font>,<font COLOR="#000077">&quot;rb&quot;</font>);</p>
	<p>if(<font COLOR="#808080">f</font>){</p>
	<blockquote>
		<p><font COLOR="#880000">fread</font>(<font COLOR="#808080">szKey</font>,32,1,<font COLOR="#808080">f</font>);</p>
		<p><font COLOR="#880000">fclose</font>(<font COLOR="#808080">f</font>);</p>
	</blockquote>
	<p>}</p>
	<p>if(<font COLOR="#880000">strncmp</font>(<font COLOR="#808080">szKey</font>,<font COLOR="#000077">&quot;demo&quot;</font>,4)==0)</p>
	<p>{<font COLOR="#009900">//功能演示版，有使用次数限制,可以试用100次,将使用次数记录到注册表</p>
	</font>
	<blockquote>
		<p><font COLOR="#0000ff">HKEY</font> <font COLOR="#808080">hKey</font>=0;</p>
		<p>long <font COLOR="#808080">dwData</font>=0,<font COLOR="#808080">dwSize</font>=4;</p>
		<p>if(<font COLOR="#a000a0">ERROR_SUCCESS</font>!=<font COLOR="#a000a0">RegOpenKeyEx</font>(<font COLOR="#a000a0">HKEY_CURRENT_USER</font>,<font COLOR="#000077">&quot;Software&quot;</font>,0,<font COLOR="#a000a0">KEY_ALL_ACCESS</font>,&amp;<font COLOR="#808080">hKey</font>)) 
		return 0;</p>
		<p><font COLOR="#a000a0">RegQueryValueEx</font>(<font COLOR="#808080">hKey</font>,<font COLOR="#000077">&quot;times&quot;</font>,0,<font COLOR="#a000a0">NULL</font>,(<font COLOR="#0000ff">LPBYTE</font>)&amp;<font COLOR="#808080">dwData</font>,(<font COLOR="#0000ff">LPDWORD</font>)&amp;<font COLOR="#808080">dwSize</font>);</p>
		<p><font COLOR="#808080">dwData</font>++;</p>
		<p><font COLOR="#a000a0">RegSetValueEx</font>(<font COLOR="#808080">hKey</font>,<font COLOR="#000077">&quot;times&quot;</font>,0,<font COLOR="#a000a0">REG_DWORD</font>,(<font COLOR="#0000ff">LPBYTE</font>)&amp;<font COLOR="#808080">dwData</font>,sizeof(<font COLOR="#808080">dwData</font>));</p>
		<p><font COLOR="#880000">RegCloseKey</font>(<font COLOR="#808080">hKey</font>);</p>
		<p>return <font COLOR="#808080">dwData</font>&lt;100;</p>
	</blockquote>
	<p>}else</p>
	<p>{<font COLOR="#009900">//此key代表您分配给该用户的注册码，该注册码是您通过相同的算法对用户提供的信息进行加密获得的。</p>
	</font>
	<p><font COLOR="#009900">//在此您需要用相同的办法获得用户信息，再与szKey进行比较,再判断用户是否经过授权</p>
	</font>
	<blockquote>
		<p>return <font COLOR="#a000a0">FALSE</font>;</p>
	</blockquote>
	<p>}</p>
</blockquote>
<p>}</p>
<p>　</p>
<p>　</p>

</body>

</html>
